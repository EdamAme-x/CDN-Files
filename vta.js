/* (c): https://evex.land and @amex2189 - View Transition by Auto JS */
;function onVtaReload(){document.head.innerHTML+=`<style>.vta-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow: hidden;white-space:nowrap;width:1px;height:1px;}</style>`}const $=e=>history.state&&history.replaceState({...history.state,...e},""),g=!!document.startViewTransition,E=()=>!0,S=e=>location.pathname===e.pathname&&location.search===e.search,k=e=>document.dispatchEvent(new Event(e)),x=()=>k("on-vta-load"),H=()=>{let e=document.createElement("div");e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),e.className="vta-route-announcer",document.body.append(e),setTimeout(()=>{let r=document.title||document.querySelector("h1")?.textContent||location.pathname;e.textContent=r,onVtaReload()},60)},d="data-vta-transition-persist";let T,y=0;history.state?(y=history.state.index,scrollTo({left:history.state.scrollX,top:history.state.scrollY})):E()&&history.replaceState({index:y,scrollX,scrollY,intraPage:!1},"");const M=(e,r)=>{let a=!1,n=!1;return(...l)=>{if(a){n=!0;return}e(...l),a=!0,setTimeout(()=>{n&&(n=!1,e(...l)),a=!1},r)}};async function R(e){try{let r=await fetch(e),a=r.headers.get("content-type")?.replace(/;.*$/,"");return"text/html"!==a&&"application/xhtml+xml"!==a?null:{html:await r.text(),redirected:r.redirected?r.url:void 0,mediaType:a}}catch{return null}}function P(){return"animate"}function F(){let e=Promise.resolve();for(let r of Array.from(document.scripts)){if(""===r.dataset.vtaExec)continue;let a=document.createElement("script");for(let n of(a.innerHTML=r.innerHTML,r.attributes)){if("src"===n.name){let l=new Promise(e=>{a.onload=e});e=e.then(()=>l)}a.setAttribute(n.name,n.value)}a.dataset.vtaExec="",r.replaceWith(a)}return e}function I(e){let r=e.effect;return!!(r&&r instanceof KeyframeEffect)&&!!r.target&&"infinite"===window.getComputedStyle(r.target,r.pseudoElement).animationIterationCount}const L=(e,r,a)=>{let n=!S(e),l=!1;e.href!==location.href&&(r?history.replaceState({...history.state},"",e.href):(history.replaceState({...history.state,intraPage:a},""),history.pushState({index:++y,scrollX:0,scrollY:0},"",e.href)),n&&(scrollTo({left:0,top:0,behavior:"instant"}),l=!0)),e.hash?location.href=e.href:l||scrollTo({left:0,top:0,behavior:"instant"})};function X(e){let r=[];for(let a of e.querySelectorAll("head link[rel=stylesheet]"))if(!document.querySelector(`[${d}="${a.getAttribute(d)}"], link[rel=stylesheet][href="${a.getAttribute("href")}"]`)){let n=document.createElement("link");n.setAttribute("rel","preload"),n.setAttribute("as","style"),n.setAttribute("href",a.getAttribute("href")),r.push(new Promise(e=>{["load","error"].forEach(r=>n.addEventListener(r,e)),document.head.append(n)}))}return r}async function w(e,r,a,n,l){let i=r=>{let a=r.getAttribute(d),n=a&&e.head.querySelector(`[${d}="${a}"]`);if(n)return n;if(r.matches("link[rel=stylesheet]")){let l=r.getAttribute("href");return e.head.querySelector(`link[rel=stylesheet][href="${l}"]`)}return null},o=()=>{let e=document.activeElement;if(!e?.closest(`[${d}]`))return{activeElement:null};if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){let r=e.selectionStart,a=e.selectionEnd;return{activeElement:e,start:r,end:a}}return{activeElement:e}},s=({activeElement:e,start:r,end:a})=>{e&&(e.focus(),(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(e.selectionStart=r,e.selectionEnd=a))},c=()=>{let l=document.documentElement,c=[...l.attributes].filter(({name:e})=>(l.removeAttribute(e),e.startsWith("data-vta-")));for(let f of([...e.documentElement.attributes,...c].forEach(({name:e,value:r})=>l.setAttribute(e,r)),document.scripts))for(let u of e.scripts)if(!f.src&&f.textContent===u.textContent||f.src&&f.type===u.type&&f.src===u.src){u.dataset.vtaExec="";break}for(let h of Array.from(document.head.children)){let p=i(h);p?p.remove():h.remove()}document.head.append(...e.head.children);let m=document.body,b=o();for(let A of(document.body.replaceWith(e.body),m.querySelectorAll(`[${d}]`))){let _=A.getAttribute(d),V=document.querySelector(`[${d}="${_}"]`);V&&V.replaceWith(A)}s(b),n?scrollTo(n.scrollX,n.scrollY):L(r,"replace"===a.history,!1),k("after-vta-swap")},f=X(e);if(f.length&&await Promise.all(f),"animate"===l){let u=document.getAnimations();document.documentElement.dataset.vtaTransitionFallback="old";let h=document.getAnimations().filter(e=>!u.includes(e)&&!I(e));await Promise.all(h.map(e=>e.finished)),c(),document.documentElement.dataset.vtaTransitionFallback="new"}else c()}async function q(e,r,a,n){let l,i=r.href,o=await R(i);if(null===o){location.href=i;return}o.redirected&&(r=new URL(o.redirected)),T??=new DOMParser;let s=T.parseFromString(o.html,o.mediaType);s.querySelectorAll("noscript").forEach(e=>e.remove()),n||history.replaceState({...history.state,scrollX,scrollY},""),document.documentElement.dataset.vtaTransition=e,l=g?document.startViewTransition(()=>w(s,r,a,n)).finished:w(s,r,a,n,P());try{await l}finally{await F(),x(),H()}}function Y(e,r){if(!E()){location.href=e;return}let a=new URL(e,location.href);location.origin===a.origin&&S(a)?L(a,r?.history==="replace",!0):q("forward",a,r??{})}function C(e){if(!E()&&e.state){history.scrollRestoration&&(history.scrollRestoration="manual"),location.reload();return}if(null===e.state){history.scrollRestoration&&(history.scrollRestoration="auto");return}history.scrollRestoration&&(history.scrollRestoration="manual");let r=history.state;if(r.intraPage)scrollTo(r.scrollX,r.scrollY);else{let a=r.index,n=a>y?"forward":"back";y=a,q(n,new URL(location.href),{},r)}}const v=()=>{$({scrollX,scrollY})};for(const t of((g||"none"!==P())&&(addEventListener("popstate",C),addEventListener("load",x),"onscrollend"in window?addEventListener("scrollend",v):addEventListener("scroll",M(v,350),{passive:!0})),document.scripts))t.dataset.vtaExec="";function K(){return"animate"}function W(e){if(document.querySelector(`link[rel=prefetch][href="${e}"]`))return;if(navigator.connection){let r=navigator.connection;if(r.saveData||/(2|3)g/.test(r.effectiveType||""))return}let a=document.createElement("link");a.setAttribute("rel","prefetch"),a.setAttribute("href",e),document.head.append(a)}(g||"none"!==K())&&(document.addEventListener("click",e=>{let r=e.target;r instanceof Element&&"A"!==r.tagName&&(r=r.closest("a")),!r||!(r instanceof HTMLAnchorElement)||void 0!==r.dataset.vtaReload||r.hasAttribute("download")||!r.href||r.target&&"_self"!==r.target||r.origin!==location.origin||0!==e.button||e.metaKey||e.ctrlKey||e.altKey||e.shiftKey||e.defaultPrevented||(e.preventDefault(),Y(r.href,{history:"replace"===r.dataset.vtaHistory?"replace":"auto"}))}),["mouseenter","touchstart","focus"].forEach(e=>{document.addEventListener(e,e=>{if(e.target instanceof HTMLAnchorElement){let r=e.target;r.origin===location.origin&&r.pathname!==location.pathname&&E()&&W(r.pathname)}},{passive:!0,capture:!0})}));
